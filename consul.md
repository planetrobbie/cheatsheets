{
    "id": "auto",
    "style": "css/h4dark.css",
    "layout": "default"
}
%%%END

# HashiCorp Consul

#### Help

CLI | Description
-- | --
consul -h | general Help
consul CMD -h | help on a subcommand

#### kv

CLI | Description
-- | --
consul kv put redis/config/connections 5 | writes the data to the giv
consul kv get -detailed redis/config/connections |  retrieve the value from Consul's KV store at the given key name
consul kv get -recurse redis/ | treat the path as a prefix and list all keys which start with the given prefix
consul kv get -keys |  list keys which start with the given prefix
consul kv delete redis/ | removes the value from Consul's KV store at the given path
consul kv export redis/ | retrieve KV pairs for the given prefix from Consul's KV store, and write a JSON representation to stdout.
consul kv import redis/ | import KV pairs from the JSON representation generated by the kv export command. 
#### Operations

CLI | Description
-- | --
consul reload | reload configuration
consul operator autopilot get-config | view autopilot configuration
consul operator autopilot set-config -cleanup-dead-servers=false | disable removing failed servers as soon as a replacement Consul server comes online

#### Clustering

CLI | Description
-- | --
consul members -detailed | local view of the cluster members
curl localhost:8500/v1/catalog/nodes | strongly consistent view of the cluster members

#### Environment Variables, CLI Options

ENV Variable | Description | CLI Options
:-- | :-- | :--
CONSUL_HTTP_ADDR | The `address` and port of the Consul HTTP agent. |   -http-addr=...
CONSUL_CACERT | Path to a CA file to use for TLS when communicating with Consul | -ca-file=...
CONSUL_CAPATH | Path to a directory of CA certificates to use for TLS when communicating with Consul | -ca-path=...
CONSUL_CLIENT_CERT | Path to a client cert file to use for TLS when 'verify_incoming' is enabled. | -client-cert=...
CONSUL_CLIENT_KEY | Path to a client key file to use for TLS when 'verify_incoming is enabled | -client-key=...
CONSUL_TLS_SERVER_NAME | The server name to use as the SNI host when connecting via TLS. | -tls-server-name=
CONSUL_HTTP_TOKEN | API access token required when access control lists (ACLs) are enabled | -token=...
CONSUL_HTTP_AUTH | This specifies HTTP Basic access credentials as a username:password pair |
CONSUL_HTTP_SSL | boolean value (default is false) that enables the HTTPS URI scheme and SSL connections to the HTTP API | |
CONSUL_HTTP_SSL_VERIFY | boolean value (default true) to specify SSL certificate verification |
| Permit any Consul server (non-leader) to respond to this request | -stale
| Name of the datacenter to query, default to the datacenter of the Consul agent at the HTTP address | -datacenter=...

#### Ports

Default Port | Usage
:-- | :--
8600/tcp, 8600/udp | DNS server
8500 | HTTP API
8300 | Server RPC address
8301/tcp, 8301/udp | Serf LAN
8302/tcp, 8302/udp | Serf WAN

Also allow Inbound DNS on port 8600/tcp and 8600/udp.

#### Versions

Open Source | Pro | Premium
:-- | :-- | :--
Multi-datacenter service discovery (DNS + HTTP) | [Automated backups](https://www.consul.io/docs/enterprise/backups/index.html) | [Redundancy zone](https://www.consul.io/docs/enterprise/redundancy/index.html)
Health checks | [Automated upgrades](https://www.consul.io/docs/enterprise/upgrades/index.html) | [Advanced federation for complex network topologies](https://www.consul.io/docs/enterprise/federation/index.html)
Key/Value storage | [Enhanced read scalability](https://www.consul.io/docs/enterprise/read-scale/index.html) using -non-voting-server | Gold Support: 24x7 support w/ SLA
Runtime configuration (Consul Template) | [Network segments](https://www.consul.io/docs/enterprise/network-segments/index.html) |
Runtime orchestration | Silver Support: 9x5 support w/ SLA |
Built-in web UI for editing K/V and viewing health check status |

#### Telemetry

Send USR1 signal to consul process to dump stats to `stderr`

    pkill -USR1 consul

Can also be streamed, see [configuration](https://www.consul.io/docs/agent/options.html#telemetry)

#### Installation

Install GnuPG on your platform

macOS | ArchLinux | Debian
-- | -- | --
brew install gpg | pacman -S gnupg | apt-get install gnupg

On Debian systems you'll also need the following package which brings shasum and unzip used during installation

    apt-get install libdigest-sha-perl unzip

Import HashiCorp PGP public key

    curl https://keybase.io/hashicorp/pgp_keys.asc | gpg --import

Download Consul binary, shasum and shasum signature from [consul.io](https://www.consul.io/downloads.html).

    curl -O https://releases.hashicorp.com/consul/&lt;VERSION&gt;/consul_&lt;VERSION&gt;_&lt;OS&gt;_amd64.zip
    curl -O https://releases.hashicorp.com/consul/&lt;VERSION&gt;/consul_&lt;VERSION&gt;_SHA256SUMS
    curl -O https://releases.hashicorp.com/consul/&lt;VERSION&gt;/consul_&lt;VERSION&gt;_SHA256SUMS.sig

Replace `&lt;VERSION&gt;`, and `&lt;OS&gt;` with your os name like:  *darwin, linux, freebsd, netbsd, openbsd, solaris or windows*

Verify the authenticity of the shasum signature

    gpg --verify consul_&lt;VERSION&gt;_SHA256SUMS.sig consul_&lt;VERSION&gt;_SHA256SUMS

Make also sure the key fingerprint is

    91A6 E7F8 5D05 C656 30BE F189 5185 2D87 348F FC4C.

Check shasum of your downloaded zip file
    
    shasum -a 256 -c consul_&lt;VERSION&gt;_SHA256SUMS

If everything looks good you can safely move consul binary to your PATH

    unzip consul_&lt;VERSION&gt;_<OS>_amd64.zip
    mv consul /usr/local/bin

Check installation

    consul version

For Consul Enterprise now set the license

    consul license put "<contents_of_consul_license>"

Check it has been correcly installed

    consul license get

Complete the installation by activating the autocomplete feature

    consul -autocomplete-install

#### Configuration

XXX See longer article.

#### Consul Devt Agent

To start a development agent, in this mode you'll have a single node environment quickly and easily. But it is just for learning and testing, for sure not for production.

    consul agent -dev -ui

You can access Consul Web UI

    http://localhost:8500/ui

You can interact using the CLI by setting up the following ENV variable

    export CONSUL_HTTP_ADDR=http://localhost:8500

#### Raft

    consul operator raft list-peers